package malwaremanager

import (
	"node-agent/pkg/malwaremanager"
	"node-agent/pkg/rulemanager/exporters"

	tracerexectype "github.com/inspektor-gadget/inspektor-gadget/pkg/gadgets/trace/exec/types"
)

type MalwareManager struct {
	malwareScanners []MalwareScanner
	exporter        exporters.Exporter
}

var _ malwaremanager.MalwareManagerClient = (*MalwareManager)(nil)

func CreateMalwareManager(malwareScanners []MalwareScanner, exporter exporters.Exporter) (*MalwareManager, error) {
	return &MalwareManager{
		malwareScanners: malwareScanners,
		exporter:        exporter,
	}, nil
}

func (mm *MalwareManager) ReportFileExec(k8sContainerID string, event tracerexectype.Event) {
	for _, scanner := range mm.malwareScanners {
		if result := scanner.Scan(event); result != nil {
			mm.exporter.SendMalwareAlert(result)
		}
	}
}
